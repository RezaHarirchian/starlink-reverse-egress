# ๐ ุงุชุตุงู VPS ุงุฑุงู ุจู ุงูุชุฑูุช ุขุฒุงุฏ ุฏุฑ Shutdown ฺฉุงูู

## ูพูุดุด ุฏู ุณูุงุฑู ุนูู ุจุฑุง ุดุฑุงุท ูุฎุชูู Shutdown

---

## โ๏ธ Scope & Applicability

ุงู ูุณุชูุฏ **ุฏู ุณูุงุฑู ฺฉุงููุงู ูุชูุงูุช** ุฑุง ูพูุดุด ูโุฏูุฏ ฺฉู ุงูุชุฎุงุจ ุจู ุขูโูุง ูุงุจุณุชู ุจู ูุถุนุช Routing ุจูโุงูููู IPูุง ุงุฑุงู ุงุณุช.

ูุจู ุงุฒ ุงุฌุฑุง ูุฑ ุจุฎุดุ ุจุงุฏ ูุดุฎุต ุดูุฏ ฺฉู ุขุง **ุฏุณุชุฑุณ ูุฑูุฏ (Ingress)** ุจู IPูุง ุงุฑุงู ุงุฒ ุฎุงุฑุฌ ูุฌูุฏ ุฏุงุฑุฏ ุง ุฎุฑ.

ุณูุงุฑููุง:

- **Scenario A** โ Ingress ุจุฑูุฑุงุฑ ุงุณุชุ Egress ูุทุน ุง ูุญุฏูุฏ ุดุฏู
- **Scenario B** โ ูู Ingress ู ูู Egress ุจูโุทูุฑ ฺฉุงูู ูุทุน ุดุฏูโุงูุฏ

ุงูุชุฎุงุจ ุณูุงุฑู ุงุดุชุจุงูุ ููุฌุฑ ุจู ูพุงุฏูโุณุงุฒ ุบุฑูุงุจูโุงุณุชูุงุฏู ุฎูุงูุฏ ุดุฏ.

---

## ๐ Table of Contents

- [๐ ููุฏูู](#-ููุฏูู)
- [๐ฏ ูุฏู ูุนูุงุฑ](#-ูุฏู-ูุนูุงุฑ)
- [๐ง ุงุตู ูู ูุณุฆูู](#-ุงุตู-ูู-ูุณุฆูู-core-networking-principle)
- [๐บ ูุนูุงุฑ ฺฉู ุงุชุตุงู](#-ูุนูุงุฑ-ฺฉู-ุงุชุตุงู)
- [๐งฉ ูพุดโูุงุฒูุง](#-ูพุดูุงุฒูุง)
- [Scenario A โ VPS ุงุฑุงู + Starlink ุฎุงุฑุฌ](#scenario-a--vps-ุงุฑุงู--starlink-ุฎุงุฑุฌ-ingress-available)
- [Scenario B โ ุณุฑูุฑ ูุฒฺฉ ุฏุงุฎู ุงุฑุงู + Starlink ุฏุงุฎู ุงุฑุงู](#scenario-b--ุณุฑูุฑ-ูุฒฺฉ-ุฏุงุฎู-ุงุฑุงู--starlink-ุฏุงุฎู-ุงุฑุงู-no-ingress)
- [๐ง ุฌูุนโุจูุฏ ููุง](#-ุฌูุนโุจูุฏ-ููุง)

---

## ๐ ููุฏูู

ุงู ูุณุชูุฏ ุจุฑุง ุณูุงุฑู ููุดุชู ุดุฏู ฺฉู ุงูุชุฑูุช ุงุฑุงู ูุงุฑุฏ **Shutdown ฺฉุงูู ุฏุฑ ูุงู Routing ุจูโุงูููู** ุดุฏู ุงุณุชุ  
ูู ุงุฎุชูุงูุ ูู ูุญุฏูุฏุณุงุฒุ ูู ููุชุฑูฺฏ.

ุจูโุตูุฑุช ุฏูู ุนู:

* VPS ูุณุชูุฑ ุฏุฑ ุงุฑุงู ุตุฑูุงู ุฏุงุฑุง Route ุฏุงุฎู ุงุณุช
* ูฺ Default Route ุง BGP Path ุจู ุฎุงุฑุฌ ุงุฒ ASูุง ุฏุงุฎู ูุฌูุฏ ูุฏุงุฑุฏ
* ุณุฑูุณโูุง ูุธุฑ DNS Tunnelingุ CDNุ Cloudflareุ Warp ู ุฑูุดโูุง ูุดุงุจู ุนููุงู ุบุฑูุงุจู ุงุณุชูุงุฏู ูุณุชูุฏ

ุฏุฑ ุงู ุดุฑุงุทุ ููุท **ฺฉ ูุนูุงุฑ ุงุชุตุงู ุตุญุญ ู ูุงุจู ุงุชฺฉุง** ูุฌูุฏ ุฏุงุฑุฏ.

---

## ๐ฏ ูุฏู ูุนูุงุฑ

* ุชุฃูู ุงูุชุฑูุช ุขุฒุงุฏ ุจุฑุง ฺฉุงุฑุจุฑุงู ุฏุงุฎู ุงุฑุงู
* ุญูุธ IP ุงุฑุงู ุฏุฑ ููุทู ุงุชุตุงู ฺฉุงุฑุจุฑ
* ุงูฺฉุงู ุงุณุชูุงุฏู ุฏุฑ ุญุงูุช Shutdown
* ูพุดุชุจุงู ุงุฒ Load Managementุ Failover ู Monitoring

---

## ๐ง ุงุตู ูู ูุณุฆูู (Core Networking Principle)

ุฏุฑ Shutdown ฺฉุงูู ููฺฉู ุงุณุช ฺฉ ุงุฒ ุงู ุญุงูุงุช ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ:

- ูุทุน ฺฉุงูู Egress
- ูุทุน ฺฉุงูู Ingress + Egress

ูุฑ ฺฉุฏุงู ูุงุฒููุฏ ูุนูุงุฑ ูุชูุงูุช ุงุณุช.

---

## ๐บ ูุนูุงุฑ ฺฉู ุงุชุตุงู

```
User
  |
  |  (OpenVPN / WireGuard / V2Ray)
  |
Iranian Exit Point
  |
Free Internet
```

---

## ๐งฉ ูพุดโูุงุฒูุง

- ุฏุฑฺฉ ูุถุนุช ูุงูุน Routing
- ุฏุณุชุฑุณ ุจู ุชุฌูุฒุงุช ูุชูุงุณุจ ุจุง ุณูุงุฑู ุงูุชุฎุงุจ

---

# Scenario A โ VPS ุงุฑุงู + Starlink ุฎุงุฑุฌ (Ingress Available)

> ุงู ุณูุงุฑู **ุฏููุงู ููุงู ุขููุฒุด ูุจู** ุงุณุช ู ุจุฏูู ุชุบุฑ ุงุฑุงุฆู ูโุดูุฏ.

### ฺฉุงุฑุจุฑุฏ
- ุฒูุงู ฺฉู IP ุงุฑุงู ุงุฒ ุฎุงุฑุฌ ูููุฒ ูุงุจู ุฏุณุชุฑุณ ุงุณุช
- ุฒูุงู ฺฉู VPS ุงุฑุงู ููุท ุงูุชุฑูุช ุฏุงุฎู ุฏุงุฑุฏ

### ุฎูุงุตู ูุนูุงุฑ

```
User
  |
VPS Iran
  |
Reverse Tunnel (WireGuard)
  |
Starlink (Outside Iran)
  |
Free Internet
```

### ูุณุชู ุงุชุตุงู
- Reverse ุชุงูู ุจุง WireGuard
- Initiator ุฎุงุฑุฌ ุงุฒ ุงุฑุงู
- VPS ุงุฑุงู ููุท Listen ูโฺฉูุฏ

### ุงุชุตุงู ฺฉุงุฑุจุฑ
- OpenVPN
- WireGuard
- V2Ray (VLESS)

### Load Balance / Failover
- Policy-Based Routing
- Failover ูุจุชู ุจุฑ Health Check

---

# Scenario B โ ุณุฑูุฑ ูุฒฺฉ ุฏุงุฎู ุงุฑุงู + Starlink ุฏุงุฎู ุงุฑุงู (No Ingress)

## ุชูุถุญ ุณูุงุฑู

ุฏุฑ ุงู ุณูุงุฑู:
- ูฺ IP ุงุฑุงู ุงุฒ ุฎุงุฑุฌ Route ููโุดูุฏ
- ุงุณุชูุงุฏู ุงุฒ VPS ุฏุชุงุณูุชุฑ ุบุฑููฺฉู ุงุณุช
- ุชููุง ุฑุงูุ ุฎุฑูุฌ ฺฉุงูู ุงุฒ ISP ุงุฑุงู ุงุณุช

### ูุนูุงุฑ

```
User
  |
Physical Server (Iran)
  |
Starlink
  |
Free Internet
```

---

## ๐งฉ ูพุดโูุงุฒูุง ุณูุงุฑู B

### ุณุฎุชโุงูุฒุงุฑ

- Starlink ูุนุงู ุฏุงุฎู ุงุฑุงู
- ฺฉ ุงุฒ ููุงุฑุฏ ุฒุฑ:
  - Mini PC x86
  - ุณุฑูุฑ ูููฺฉุณ ุณุงุฏู
  - RouterOS / OpenWrt

### ูุฑูโุงูุฒุงุฑ

- Linux (Ubuntu Server)
- WireGuard / OpenVPN / V2Ray

---

## ๐ ูพุงุฏูโุณุงุฒ ูพุงู ุณูุงุฑู B

### ูุนุงูโุณุงุฒ Routing

```bash
sysctl -w net.ipv4.ip_forward=1
```

### NAT ุฎุฑูุฌ ุฑู Starlink

```bash
iptables -t nat -A POSTROUTING -o starlink0 -j MASQUERADE
```

---

## ๐ ุงุชุตุงู ฺฉุงุฑุจุฑุงู ุฏุฑ ุณูุงุฑู B

ฺฉุงุฑุจุฑุงู ุจู **IP ุงุฑุงู ููู ุณุฑูุฑ ูุฒฺฉ** ูุชุตู ูโุดููุฏ.

- OpenVPN: ููุงุณุจ ุนููู
- WireGuard: ุณุจฺฉ ู ุณุฑุน
- V2Ray: ููุงุณุจ ฺฉุงุฑุจุฑ ุฒุงุฏ

---

## โ๏ธ Load Management ุฏุฑ ุณูุงุฑู B

ูุญุฏูุฏุช ุงุตู Starlink:

- ฺฉ ููฺฉ
- throughput ูุญุฏูุฏ

ุฑุงูฺฉุงุฑูุง:
- Limit per user
- Queue management (fq_codel)
- Session caps

---

## โก Failover ุฏุฑ ุณูุงุฑู B

Failover ุฏุฑ ุงู ุณูุงุฑู **ูุฒฺฉ** ุงุณุช:

- UPS
- ููฺฉ ุฌุงฺฏุฒู (ุฏุฑ ุตูุฑุช ุงูฺฉุงู)
- ูุงูุชูุฑูฺฏ ุฏุงุฆู ููฺฉ

---

## ๐ Monitoring ุฏุฑ ุณูุงุฑู B

- Latency
- Packet loss
- Throughput
- Session count

ุงุจุฒุงุฑูุง:
- Netdata
- vnStat
- Prometheus (ุงุฎุชุงุฑ)

---

## ๐ง ุฌูุนโุจูุฏ ููุง

- **Scenario A** ููุงุณุจ ุดุฑุงุท ุงุณุช ฺฉู Ingress ูููุฒ ูุฌูุฏ ุฏุงุฑุฏ
- **Scenario B** ุชููุง ุฑุงู ุนูู ุฏุฑ Shutdown ูุทูู ุงุณุช
- ุงู ุฏู ุณูุงุฑู ุฌุงฺฏุฒู ูู ูุณุชูุฏุ ูฺฉูู ูู ูุณุชูุฏ
